# Optimism Package [WIP]

## Pre Setup

Note this package depends on some images existing locally

```py
OPS_BEDROCK_L1_IMAGE = "ops-bedrock-l1:latest"
OPS_BEDROCK_L2_IMAGE = "ops-bedrock-l2:latest"
OP_NODE_IMAGE = "ops-bedrock-op-node:latest"
OP_PROPOSER_IMAGE = "ops-bedrock-op-proposer:latest"
OP_BATCHER_IMAGE = "ops-bedrock-op-batcher:latest"
OP_STATEVIZ_IMAGE = "ops-bedrock-stateviz:latest"
```

To have these images ready you should run `docker compose build --progress plan` from inside `optimism/ops-bedrock`

## Installation Instructions

1. [Install kurtosis cli](https://docs.kurtosis.com/install/#ii-install-the-cli)

```bash
brew install kurtosis-tech/tap/kurtosis-cli
```

## Run Instructions

1. kurtosis run github.com/kurtosis-tech/optimism-package --enclave optimism

Kurtosis will execute the [main.star](./main.star) file to get the config as well as upload important artifacts

<img width="1719" alt="image" src="https://github.com/roninjin10/optimism-package/assets/35039927/c1aed6aa-5e55-46dd-9913-e435caf2c336">

The config is generated from Starlark, which is a subset of python to write config files. Starlark is somewhere between python and toml.

<img width="1044" alt="image" src="https://github.com/roninjin10/optimism-package/assets/35039927/78257603-3d5b-4523-b8e9-f25176a478ed">

An enclave is created. Not sure what this is.

<img width="1385" alt="image" src="https://github.com/roninjin10/optimism-package/assets/35039927/00782cbb-7fcd-400c-b836-57c1690cfe94">

Finally docker containers should be spun up

<img width="1342" alt="image" src="https://github.com/roninjin10/optimism-package/assets/35039927/5dc81b47-940c-447d-87bc-b9efb7ddd3a3">


## Test Instructions

1. kurtosis run github.com/kurtosis-tech/optimism-package --enclave optimism
2. make devnet-test

Kurtosis spins up different services on different ports inside the enclave; have to make some changes like the [following](https://github.com/ethereum-optimism/optimism/pull/7729/files) to launch tests; note use `kurtosis enclave inspect optimism` to get the 
right ports; I can automate this with a few scripts as well.

My `make devnet-test` are getting stuck at [this point](https://github.com/ethereum-optimism/optimism/blob/develop/packages/sdk/tasks/deposit-erc20.ts#L334-L335); but I see this happening for `make devnet-up && make devnet-test` too; so wondering if it
stale files.

## Caveat

Everything inside `static_files/generated` is generated by scripts in the make file - i copied over what was generated once to get things running; but this should be changed to happen inside Kurtosis or a part of a script that copies over the files generated by their python script to inside the package
